branches:
  only:
  - master
  - /^v[0-9]/
language: node_js
node_js:
- '4.2'
before_script:
- npm run format
- npm run lint
script:
- NODE_ENV=test npm test
after_success:
- NODE_ENV=test npm run report
cache:
  directories:
  - node_modules
notifications:
  slack: adventure-cycling:tk7JVJnQzyDeWadDzfdxcZYT
before_deploy:
  - npm pack
  - ln -s btc-app-server-*.tgz btc-app-server-latest.tgz
  - mkdir deploy
  - mv btc-app-server-*.tgz deploy/
deploy:
  provider: s3
  access_key_id: AKIAICLAFRF4D22VMTOA
  secret_access_key:
    secure: ao46SyTTz3mllj3wGcuBR4/0EWB9dBvBNRthmC2MFKmon477e9A+x6xpWsZ5bJlXu23xKbx66w7/f8NAZPHj1671Kv2dUiJ90Rq24tx3wRNuTDs8QE/RkwUZ+b1NEhJptjIC6tcZNDQmeDOyu7/QvKHe8IQvmG+fFvLxYgyQkpgJS23O8HcAFn+txyAMMYrw0yW9/GyktW7wpygMU5ZLlzzhVz02xrumwm/H8Z0STMX6HuT2q1d0u1BpvSPxQ/c+DWhg13yFYrFBYHRGh1lmbddWthvR62+1eDU5ujpx82YfxGgsbg50a+1JRmemdLKd0GjqVzIJVEPTwlNUFaaWStDpmPROD35AyQ+2fimil8Y85TYo68exojnCzfjhjynEY3Jkb8K26sw3OjrAbJ8ZFL8+JFU6eaTJCupjFtLNOp0MVJmZj85MD+iX/e+K6fEeFEGiA9YGhQjZO3gz1k1mn6g88dZMTbH3AfXSzFZb96SDWca5RDgT319ONfs3UR8QdYwsFm3VK+vxLbHzCsdgEEGl4Sc/t5qcCIexe5IB9huEhI/2SS528nOK1tGa18tz14ksefHy2eHghN8xKOCpPhm9JhXGbwin9X2JTWo7EXv+wmuTK8Mv95MpypaX7To5iKIrXMyVm5ZG39cmZKgXSplF9dtV0Nf67KLH21JZFE4=
  bucket: btc-app-server
  acl: private
  skip_cleanup: true
  local_dir: deploy
  detect_encoding: true
  on:
    repo: bikelomatic-complexity/btc-app-server
    branch: master
    tags: true
